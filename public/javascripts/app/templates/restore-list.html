<!-- ERROR STATUS -->
<div ng-if="hasError">
  Oops we have an error
</div>

<!-- HEADER -->
<gu-row skin="header">
  <gu-column span="2">
    <gu-row>
      <!-- COMPOSER ICON -->
      <gu-column class="center" flex span="2" gu-box="tertiary" skin="header">
        <gu-icon class="composer-icon" variant="composer-icon"></gu-icon>
      </gu-column>
      <!-- PAGE STATUS -->
      <gu-column class="center" flex span="5" gu-box="tertiary" skin="header">
        <span class="content-type">Snapshot</span>
      </gu-column>
      <gu-column span="5" gu-box="tertiary"></gu-column>
    </gu-row>
  </gu-column>
  <!-- MAIN HEADER -->
  <gu-column span="10" gu-box="tertiary" skin="header"></gu-column>
</gu-row>

<!-- PRELOADER -->
<!-- TODO -> SEPARATE INTO A PARTIAL FOR EASE OF RE-USE -->
<!-- JP 10/04/15 -->
<div ng-if="isLoading">
  <div class="spinner">
    <div class="rect1"></div>
    <div class="rect2"></div>
    <div class="rect3"></div>
    <div class="rect4"></div>
    <div class="rect5"></div>
  </div>
</div>

<gu-row ng-if="!isLoading" class="content">
  <gu-column  class="sidebar"
              span="3"
              gu-box="secondary"
              ng-class="{'active': isSidebarActive}"
              ng-controller="SnapshotListInteractionCtrl as ctrl">

    <!-- SNAPSHOT LIST HEADER -->
    <h1 class="article-headline">{{ articleTitle }}</h1>
    <h6 class="article-hash">({{ articleHash }})</h6>

    <gu-row class="snapshot-list-header">
      <span class="snapshot-list-header__decal">No.</span>
      <span class="snapshot-list-header__content">Snapped at</span>
    </gu-row>

    <!-- SNAPSHOT LIST -->
    <gu-index-list class="snapshot-list">
      <gu-index-list-item variant="{{ model.get('activeState') ? 'quaternary' : 'primary' }}"
                          class="snapshot-list__item"
                          ng-repeat-start="model in models"
                          index="{{ models.length - $index }}"
                          ng-class="{ 'item-active': model.get('activeState') }">
        <!-- CONTENT -->
        <div  class="snapshot-list__item__content"
              ng-click="ctrl.onItemClicked($index)">
          <h6 class="snapshot-list__item__content__relative-date">{{ model.getRelativeDate() }}</h6>
          <h6 class="snapshot-list__item__content__actual-date">{{ model.getCreatedDate() }}</h6>
        </div>

        <!-- JSON LINK -->
        <gu-btn class="snapshot-list__item__json"
                href="#"
                variant="arrow-right"
                ng-class="{ hidden: !model.get('activeState') }"
                ng-click="ctrl.onJSONClicked()">
          JSON
        </gu-btn>

        <!-- RESTORE LINK -->
        <gu-btn class="snapshot-list__item__restore"
                href="#"
                variant="arrow-right"
                ng-class="{ hidden: !model.get('activeState') }"
                ng-click="ctrl.onRestoreClicked()">
          <gu-icon class="snapshot-list__item__restore__icon" variant="wrench-disabled"></gu-icon>
          Restore
        </gu-btn>

      </gu-index-list-item>

      <!-- DELTA TIME -->
      <li class="delta-row" ng-repeat-end ng-mouseover="isActive = true" ng-mouseout="isActive = false">
        <gu-row variant="reverse">
          <gu-icon class="delta-row__icon" variant="expand-disabled"></gu-icon>
          <span class="delta-row__content" ng-class="{ 'visually-hidden': !isActive }">
            {{ model.getRelativeDate( models[$index + 1].get('createdDate') ) }}
          </span>
        </gu-row>
      </li>

    </gu-index-list>

  </gu-column>

  <!-- CONTENT -->
  <gu-column  class="snapshot-content"
              span="9"
              ng-controller="SnapshotContentCtrl as ctrl"
              ng-class="{'active': isSettingContent === false}">
    <div class="snapshot-content__viewport">
      <gu-row class="snapshot-content__container" ng-class="{ 'show-html': isShowingHtml }">

        <!-- JSON CONTENT -->
        <gu-column class="snapshot-content__container__item--json" span="6">
          <div><pre><code>{{ jsonContent }}</code></pre></div>
        </gu-column>

        <!-- HTML CONTENT -->
        <gu-column span="6" class="snapshot-content__container__item">
          <div ng-bind-html="htmlContent"></div>
        </gu-column>

      </gu-row>
    </div>
  </gu-column>

  <!-- MODAL -->
  <!-- INLINE STYLE TO AVOID INITIAL FLASH OF CONTENT WITH THE MODAL -->
  <div style="display: none"
       class="modal center"
       ng-controller="ModalCtrl as modalCtrl"
       ng-class="{ 'visually-hidden': !isActive }">
    <gu-box class="modal__content" variant="primary">
      <form novalidate class="modal-form" ng-controller="RestoreFormCtrl as formCtrl" ng-submit="formCtrl.onSubmit()">
        <div class="modal__content__track">
          <gu-row>
            <gu-column ng-class="{ 'in-active': isLoading }" class="form-panel" span="6">

              <!-- MODAL HEADER -->
              <gu-row>
                <gu-column span="12">
                  <h1 class="modal__content__title">Before you restore</h1>
                  <p class="modal__content__desc">Currently present in the content</p>
                </gu-column>
              </gu-row>

              <!-- PRESENCE -->
              <gu-row class="modal__content__container">
                <gu-column span="9">
                  some people
                </gu-column>
                <gu-column span="3">
                  <a class="model__content__refresh">
                    <gu-icon variant="expand-active"></gu-icon>
                    Refresh
                  </a>
                </gu-column>
              </gu-row>

              <!-- FORM -->
              <gu-row class="modal__content__container">
                <gu-column span="12" class="modal__content__form">
                  <h2 class="modal__content__form__header">Make sure that:</h2>
                  <gu-row class="modal__content__form__fieldset">
                    <label for="self-in-content">
                      <input type="checkbox" ng-model="selfInContent" name="selfInContent" id="self-in-content" />
                      <span class="checked-decal"></span>
                      <span class="label">You are not in content</span>
                    </label>
                  </gu-row>
                  <gu-row class="modal__content__form__fieldset">
                    <label for="else-in-content">
                      <input type="checkbox" ng-model="elseInContent" name="elseInContent" id="else-in-content" />
                      <span class="checked-decal"></span>
                      <span class="label">No one else is in the content</span>
                    </label>
                  </gu-row>
                </gu-column>
              </gu-row>

              <!-- ACTIONS -->
              <gu-row variant="reverse" class="modal__content__container">
                <gu-btn class="modal__content__btn" type="submit" ng-disabled="!selfInContent || !elseInContent">
                  <gu-icon variant="wrench-disabled"></gu-icon>
                  Restore Version
                </gu-btn>
                <gu-btn class="modal__content__btn--close" type="reset" ng-click="modalCtrl.closeModal()">Cancel</gu-btn>
              </gu-row>

            </gu-column>

            <!-- LOADER -->
            <gu-column span="6" class="form-loading"  ng-class="{ 'in-active': isLoading }" >
              <div class="spinner">
                <div class="rect1"></div>
                <div class="rect2"></div>
                <div class="rect3"></div>
                <div class="rect4"></div>
                <div class="rect5"></div>
              </div>
            </gu-column>
          </gu-row>
        </div>
      </form>
    </gu-box>
  </div>

</gu-row>
